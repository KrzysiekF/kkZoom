!function(t,e,i,o){"use strict";function s(e,i){this.element=e,this.$element=t(this.element),this.elementPosition=this.$element.position(),this.elementSize={width:this.$element.outerWidth(),height:this.$element.outerHeight()},this.bigImage=this.$element.data("zoom-image"),this.settings=t.extend({},h,i),this._defaults=h,this._name=n,this.init()}var n="kkZoom",h={parentSize:!1,zoomButtonWidth:30,zoomButtonHeight:30,zoomWidth:795,zoomHeight:641,debug:!1,afterZoomOpened:function(){},afterZoomClosed:function(){}};t.extend(s.prototype,{init:function(){var t=this.createZoomButton(),e=this.createZoomImage();this.$element.before(t),this.bindEvents(t,e)},bindEvents:function(t,e){var i=this;t.on("click",function(){return i.calculatePosition(e),!1})},calculatePosition:function(e){this.log("====> calculatePosition"),this.settings.parentSize?(this.log("--> ALIGN PARENT: ",t(this.settings.parentSize).length),this.calculatePositionParent(e)):(this.log("--> ALIGN ELEMENT: ",this.$element.length),this.calculatePositionAuto(e)),this.log("=================")},calculatePositionParent:function(e){var i=this,o=this.$element.parents(this.settings.parentSize),s=Math.floor(this.$element.offset().top-o.offset().top),n=Math.floor(this.$element.offset().left-o.offset().left),h=this.elementSize.height/this.elementSize.width,l=Math.floor(o.outerWidth()*h),a=t("body").height()-o.offset().top-this.$element.height(),m=l<a;this.log("--> height: ",l),this.log("--> bottom: ",a),this.log("--> space to bottom: ",m),e.css({top:m?-1*s:"auto",bottom:m?"auto":0,left:-1*n,width:o.outerWidth(),"max-width":o.outerWidth(),height:l}),i.openZoom(e)},calculatePositionAuto:function(i){var o=this,s=Math.floor(this.$element.offset().left),n=Math.floor(t(e).outerWidth()-s-this.elementSize.width),h=s-n;this.log("--> toLeft: ",s),this.log("--> toRight: ",n),this.log("--> difference: ",h),i.css({width:o.settings.zoomWidth,height:o.settings.zoomHeight}),h<50&&h>-50?(this.log("--> center"),i.css({transform:"translate(-50%, 0)","margin-left":"50%"}),o.openZoom(i)):h<0?(this.log("--> left"),o.openZoom(i)):h>0&&(this.log("--> right"),i.css({transform:"translate(-100%, 0)","margin-left":"100%"}),o.openZoom(i))},openZoom:function(t){var e=this;e.$element.before(t),setTimeout(function(){t.addClass("kk-zoom-image-big").css({top:t.position().top,bottom:"auto",opacity:1}),e.settings.afterZoomOpened()},10),t.on("click",function(){e.closeZoom(t)})},closeZoom:function(t){var e=this;this.log("===> closeZoom"),this.log("--> image top: ",t.position().top),this.log("--> top: ",e.elementPosition.top),t.css({width:e.elementSize.width,height:e.elementSize.height,top:e.elementPosition.top,left:e.elementPosition.left,opacity:0}),e.settings.afterZoomClosed(),setTimeout(function(){t.remove()},300)},createZoomButton:function(){var e=t(i.createElement("a"));return e.attr({href:"javacript://"}),e.css({top:this.elementPosition.top,left:this.elementPosition.left,width:this.elementSize.width,height:this.elementSize.height}),e.addClass("kk-zoom-button"),e},createZoomImage:function(){var e=null;return e=this.settings.parentSize?t(i.createElement("img")).attr({src:this.bigImage}).css({width:this.elementSize.width,height:this.elementSize.height,top:this.elementPosition.top,left:this.elementPosition.left,opacity:0}).addClass("kk-zoom-image"):t(i.createElement("div")).css({"background-image":"url("+this.bigImage+")",width:this.elementSize.width,height:this.elementSize.height,top:this.elementPosition.top,left:this.elementPosition.left,opacity:0}).addClass("kk-zoom-image")},log:function(t,e){this.settings.debug&&(e===o?console.log(t):console.log(t,e))}}),t.fn[n]=function(e){return this.each(function(){t.data(this,"plugin_"+n)||t.data(this,"plugin_"+n,new s(this,e))})}}(jQuery,window,document);